# Configuración de rotación de logs para Health Check Monitoring
# Ubicación: /etc/logrotate.d/health-check (requiere sudo)
# O usar con: logrotate -f scripts/logrotate.conf

/var/www/api_sequelize/logs/health-check-*.log {
    # Rotar diariamente
    daily
    
    # Mantener 30 días de logs
    rotate 30
    
    # Comprimir logs antiguos
    compress
    
    # No comprimir el log más reciente
    delaycompress
    
    # No fallar si el archivo no existe
    missingok
    
    # No rotar si está vacío
    notifempty
    
    # Crear nuevo archivo con permisos específicos
    create 0644 www-data www-data
    
    # Añadir fecha a los archivos rotados
    dateext
    dateformat -%Y%m%d
    
    # Tamaño máximo antes de forzar rotación
    maxsize 100M
    
    # Script post-rotación (opcional)
    postrotate
        # Limpiar métricas JSON antiguas (mantener solo últimos 7 días)
        find /var/www/api_sequelize/metrics -name "health-*.json" -mtime +7 -delete 2>/dev/null || true
    endscript
}

# Logs del cron
/var/www/api_sequelize/logs/cron.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 0644 www-data www-data
    maxsize 50M
}
