# SSL A+ Configuration compatible with Certbot - TIENDA
# Este archivo mantiene la funcionalidad original + mejoras SSL A+

server {
   root /var/www/tienda_ecommerce_mean/ecommerce;
   index index.html index.htm index.nginx-debian.html;

   server_name tienda.lujandev.com;

   location / {
      try_files $uri $uri/ /index.html;
      
      # Security headers para p치ginas
      add_header X-Frame-Options DENY always;
      add_header X-Content-Type-Options nosniff always;
      add_header X-XSS-Protection "1; mode=block" always;
   }
   
   # Cache para assets est치ticos (mejora performance)
   location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
       expires 1y;
       add_header Cache-Control "public, immutable";
       add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
   }

   # SSL Configuration original de Certbot (MANTENER)
   listen 443 ssl http2; # HTTP/2 a침adido para A+
   ssl_certificate /etc/letsencrypt/live/tienda.lujandev.com/fullchain.pem; # managed by Certbot
   ssl_certificate_key /etc/letsencrypt/live/tienda.lujandev.com/privkey.pem; # managed by Certbot
   include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
   ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

   # SSL A+ enhancements
   # Note: ssl_session_cache, ssl_session_timeout ya est치n en options-ssl-nginx.conf
   
   # Security headers globales
   add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
   add_header X-Frame-Options DENY always;
   add_header X-Content-Type-Options nosniff always;
   add_header X-XSS-Protection "1; mode=block" always;
   add_header Referrer-Policy "strict-origin-when-cross-origin" always;
   add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://connect.facebook.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://api.lujandev.com; frame-ancestors 'none';" always;
   
   # Disable server tokens
   server_tokens off;
}

server {
    if ($host = tienda.lujandev.com) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

   listen 80;
   server_name tienda.lujandev.com;
   return 404; # managed by Certbot
}